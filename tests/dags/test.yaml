default_args:
  owner: nguyenvantuan140397@gmail.com
  start_date: 2024-06-28
schedule: "0 2 * * *"
tasks:
  score_products:
    operator: BigQueryOperator
    sql: SELECT * FROM `dwh.product.vw_product_fraud_score`
    destination_dataset_table: "dwh.product.product_scoring_{{ macros.localtz.ds_nodash(ti) }}"

  update_realtime_cached:
    operator: BigqueryToSheetOperator
    sheet_url: "product.product_scores"
    sql: |
      SELECT CAST(sku AS STRING) sku, product_fraud_score_new score
      FROM `dwh.product.vw_product_fraud_score_update`
      WHERE sku IS NOT NULL
    dependencies: ["score_products"]
